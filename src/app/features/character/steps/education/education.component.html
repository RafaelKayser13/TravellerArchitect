<div class="education-container">
    <app-step-header 
        stepSymbol="SEC" 
        stepNumber="05" 
        superLabel="ACADEMIC_RECORDS_SYSTEM"
        topLabel="ACADEMIC_HISTORY"
        title="ACADEMIC_ENROLLMENT" 
        subtitle="SUBMIT APPLICATION FOR HIGHER EDUCATION OR PROCEED TO NATIONAL DRAFT">
    </app-step-header>

  <div class="education-stack" *ngIf="$any(admissionStatus) === 'NotApplied'">
    <!-- University -->
    <div class="education-card" [class.selected]="educationType === 'University'"
      (click)="educationType = 'University'">
      <div class="card-layout">
        <div class="info-column">
          <div class="card-header">
            <span class="index">01</span>
            <h3>University</h3>
          </div>
          <div class="details">
            <p><span class="label">REQUIREMENT:</span> <span class="highlight">EDU 7+</span></p>
            <p><span class="label">EXPECTED_GAIN:</span> <span class="highlight">+1 EDU, +1 SOC</span></p>
            <div class="description-text">
              Higher education focused on academic research and social advancement.
              Essential for high-tech careers and political standing.
            </div>
          </div>
        </div>

        <div class="config-column" *ngIf="educationType === 'University'" (click)="$event.stopPropagation()">
          <div class="admission-method">
            <span class="hud-label">[ ADM_PROTOCOL_SELECTION ]</span>
            <div class="radio-tab-group">
              <label class="radio-tab">
                <input type="radio" name="admMethod" value="Local" [(ngModel)]="admissionMethod" />
                <div class="tab-content">
                  <span class="primary">LOCAL_ADM</span>
                  <span class="secondary">DM {{ admissionDMs.local >= 0 ? '+' : '' }}{{ admissionDMs.local }}</span>
                </div>
              </label>
              <label class="radio-tab">
                <input type="radio" name="admMethod" value="OffWorld" [(ngModel)]="admissionMethod" />
                <div class="tab-content">
                  <span class="primary">OFFWORLD_ADM</span>
                  <span class="secondary">DM {{ admissionDMs.offWorld >= 0 ? '+' : '' }}{{ admissionDMs.offWorld
                    }}</span>
                  <span class="risk-tag" *ngIf="admissionMethod === 'OffWorld'">DEBT_RISK</span>
                </div>
              </label>
            </div>
          </div>

          <button class="btn-action" (click)="apply()"
            [disabled]="$any(admissionStatus) === 'Admitted' || $any(admissionStatus) === 'Rejected'">
            INIT_APPLICATION
          </button>
        </div>
      </div>
    </div>

    <!-- Academy -->
    <div class="education-card" [class.selected]="educationType === 'Academy'" (click)="educationType = 'Academy'">
      <div class="card-layout">
        <div class="info-column">
          <div class="card-header">
            <span class="index">02</span>
            <h3>Military Academy</h3>
          </div>
          <div class="details">
            <p><span class="label">REQUIREMENT:</span> <span class="highlight">ATTR 8+</span></p>
            <p><span class="label">EXPECTED_GAIN:</span> <span class="highlight">OFFICER COMMISSION</span></p>
            <div class="description-text">
              Intensive military training providing immediate access to officer ranks.
              Focuses on discipline, command, and specialized combat skills.
            </div>
          </div>
        </div>

        <div class="config-column" *ngIf="educationType === 'Academy'" (click)="$event.stopPropagation()">
          <div class="branch-selector">
            <span class="hud-label">[ SELECT_MIL_BRANCH ]</span>
            <select [(ngModel)]="academyType" class="cyber-select">
              <option value="Army">ARMY (END BRANCH)</option>
              <option value="Marines">MARINES (END BRANCH)</option>
              <option value="Navy">NAVY (INT BRANCH)</option>
              <option value="Scouts">SCOUTS (INT BRANCH)</option>
              <option value="Spaceborne">SPACEBORNE (INT BRANCH)</option>
            </select>
          </div>

          <div class="admission-method">
            <span class="hud-label">[ MIL_ADM_PROTOCOL ]</span>
            <div class="radio-tab-group">
              <label class="radio-tab">
                <input type="radio" name="admMethodAc" value="Local" [(ngModel)]="admissionMethod" />
                <div class="tab-content">
                  <span class="primary">LOCAL_ADM</span>
                  <span class="secondary">DM {{ admissionDMs.local >= 0 ? '+' : '' }}{{ admissionDMs.local }}</span>
                </div>
              </label>
              <label class="radio-tab">
                <input type="radio" name="admMethodAc" value="OffWorld" [(ngModel)]="admissionMethod" />
                <div class="tab-content">
                  <span class="primary">OFFWORLD_ADM</span>
                  <span class="secondary">DM {{ admissionDMs.offWorld >= 0 ? '+' : '' }}{{ admissionDMs.offWorld
                    }}</span>
                </div>
              </label>
            </div>
          </div>

          <button class="btn-action" (click)="apply()"
            [disabled]="$any(admissionStatus) === 'Admitted' || $any(admissionStatus) === 'Rejected'">
            INIT_MIL_APPLICATION
          </button>
        </div>
      </div>
    </div>

    <!-- Draft -->
    <div class="education-card draft-card" [class.selected]="educationType === 'None'" (click)="educationType = 'None'">
      <div class="card-layout">
        <div class="info-column">
          <div class="card-header">
            <span class="index">03</span>
            <h3>National Draft</h3>
          </div>
          <div class="details">
            <p><span class="label">STATUS:</span> <span class="highlight">IMMEDIATE_ENLISTMENT</span></p>
            <p><span class="label">ACTION:</span> <span class="highlight">BYPASS EDUCATION</span></p>
          </div>
        </div>

        <div class="config-column" *ngIf="educationType === 'None'" (click)="$event.stopPropagation()">
          <div class="draft-notice">
            <p>Skip higher education and proceed directly to mandatory service draft.
              This will advance the timeline to SERVICE_TERM_01.</p>
          </div>
          <button class="btn-action warn" (click)="finishStep()">PROCEED_TO_DRAFT</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Results -->
  <div class="results" *ngIf="$any(admissionStatus) !== 'NotApplied'" #resultsSection>
    <div class="status-box" [ngClass]="admissionStatus.toLowerCase()" *ngIf="$any(admissionStatus) === 'Rejected'">
      <h3>APPLICATION_REJECTED</h3>
      <button class="btn-cyber" (click)="finishStep()" style="margin-top: 2rem;">START_A_CAREER</button>
    </div>

    <!-- University Skill Selection (Step 2) -->
    <div class="skill-selection" *ngIf="educationStep === 'UniversitySkillSelect'" #skillsSection>
      <h3>ADM_SUCCESSFUL</h3>
      <p>ALLOCATE SPECIALIZATION SCHEMATICS FOR ADOPTION</p>

      <div class="selectors">
        <div class="sel-group">
          <label>MAJOR_VECTOR (LVL 1)</label>
          <select [(ngModel)]="selectedMajorSkill">
            <option value="" disabled>SELECT_SCHEMATIC</option>
            <option *ngFor="let s of universitySkillList" [value]="s">{{ s }}</option>
          </select>
        </div>
        <div class="sel-group">
          <label>MINOR_VECTOR (LVL 0)</label>
          <select [(ngModel)]="selectedMinorSkill">
            <option value="" disabled>SELECT_SCHEMATIC</option>
            <option *ngFor="let s of universitySkillList" [value]="s" [disabled]="s === selectedMajorSkill">
              {{ s }}
            </option>
          </select>
        </div>
      </div>

      <button class="btn-cyber" [disabled]="!selectedMajorSkill || !selectedMinorSkill"
        (click)="confirmUniversitySkills()">
        FINALIZE_ENROLLMENT
      </button>
    </div>

    <!-- Studying State -->
    <div *ngIf="educationStep === 'Studying'" style="text-align: center; padding: 3rem;">
      <span class="hud-label" style="font-size: 1.2rem; margin-bottom: 2rem; display: block; color: var(--neon-cyan);">[
        ACADEMIC_TERM_IN_PROGRESS ]</span>
      <p style="font-family: var(--font-mono); color: var(--text-dim); margin-bottom: 2rem;">PROCESSING 4-YEAR
        EDUCATIONAL DATA...</p>
      <button class="btn-cyber" (click)="graduate()">EXECUTE_GRADUATION_ROLL</button>
    </div>

    <!-- Academy Graduation Skill Selection -->
    <div class="skill-selection" *ngIf="educationStep === 'AcademySkillSelect'">
      <h3>GRADUATION_COMPLETE</h3>
      <p>SELECT 3 SPECIALIST TRACE_SKILLS (SET TO LVL 1)</p>

      <div class="skill-grid">
        <div class="skill-opt" *ngFor="let skill of availableAcademySkills" [class.selected]="
            selectedAcademySkills[0] === skill ||
            selectedAcademySkills[1] === skill ||
            selectedAcademySkills[2] === skill
          " (click)="toggleAcademySkill(skill)">
          {{ skill }}
        </div>
      </div>

      <button class="btn-cyber" [disabled]="(selectedAcademySkills | keyvalue).length !== 3"
        (click)="confirmAcademyGraduation()">
        CONFIRM_SPECIALIZATION
      </button>
    </div>

    <div *ngIf="educationStep === 'Finished' && graduationStatus !== 'Pending'" class="graduation-result">
      <h3>{{ graduationStatus === 'Failed' ? 'GRADUATION_FAILED' : 'GRADUATION_CONFIRMED' }}</h3>
      <p *ngIf="graduationStatus === 'Honors'">[ HONORS_DISTINCTION_DETECTED ]</p>
    </div>
  </div>
</div>