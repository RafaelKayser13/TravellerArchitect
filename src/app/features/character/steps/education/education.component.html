<div class="education-container">
  <app-step-header stepSymbol="SEC" stepNumber="05" superLabel="ACADEMIC_RECORDS_SYSTEM" topLabel="ACADEMIC_HISTORY"
    title="ACADEMIC_ENROLLMENT" subtitle="SUBMIT APPLICATION FOR HIGHER EDUCATION OR PROCEED DIRECTLY TO A CAREER">
  </app-step-header>

  <div class="education-stack" *ngIf="$any(admissionStatus) === 'NotApplied'">
    <!-- University -->
    <div class="education-card" [class.selected]="educationType === 'University'"
      (click)="educationType = 'University'">
      <div class="card-corner tl"></div>
      <div class="card-corner tr"></div>
      <div class="card-corner bl"></div>
      <div class="card-corner br"></div>
      <div class="card-scan-line"></div>
      <span class="card-type-tag">ACADEMIC</span>
      <div class="card-layout">
        <div class="info-column">
          <div class="card-header">
            <span class="index">01</span>
            <h3>University</h3>
            <span class="card-status-dot" [class.active]="educationType === 'University'"></span>
          </div>
          <div class="details">
            <p><span class="label">REQUIREMENT:</span> <span class="highlight">EDU 7+</span></p>
            <p><span class="label">EXPECTED_GAIN:</span> <span class="highlight">+1 EDU, +1 SOC</span></p>
            <div class="description-text">
              Higher education focused on academic research and social advancement.
              Essential for high-tech careers and political standing.
            </div>
          </div>
        </div>

        <div class="config-column" *ngIf="educationType === 'University'" (click)="$event.stopPropagation()">
          <div class="admission-method">
            <span class="hud-label">[ ADM_PROTOCOL_SELECTION ]</span>
            <div class="radio-tab-group">
              <label class="radio-tab">
                <input type="radio" name="admMethod" value="Local" [(ngModel)]="admissionMethod" />
                <div class="tab-content">
                  <span class="primary">LOCAL_ADM</span>
                  <span class="secondary">DM {{ admissionDMs.local >= 0 ? '+' : '' }}{{ admissionDMs.local }}</span>
                </div>
              </label>
              <label class="radio-tab">
                <input type="radio" name="admMethod" value="OffWorld" [(ngModel)]="admissionMethod" />
                <div class="tab-content">
                  <span class="primary">OFFWORLD_ADM</span>
                  <span class="secondary">DM {{ admissionDMs.offWorld >= 0 ? '+' : '' }}{{ admissionDMs.offWorld
                    }}</span>
                  <span class="risk-tag" *ngIf="admissionMethod === 'OffWorld'">DEBT_RISK</span>
                </div>
              </label>
            </div>
          </div>

          <button class="btn-action" (click)="apply()"
            [disabled]="$any(admissionStatus) !== 'NotApplied'">
            INIT_APPLICATION
          </button>
        </div>
      </div>
    </div>

    <!-- Academy -->
    <div class="education-card military-card" [class.selected]="educationType === 'Academy'" (click)="educationType = 'Academy'">
      <div class="card-corner tl"></div>
      <div class="card-corner tr"></div>
      <div class="card-corner bl"></div>
      <div class="card-corner br"></div>
      <div class="card-scan-line"></div>
      <span class="card-type-tag military">MILITARY</span>
      <div class="card-layout">
        <div class="info-column">
          <div class="card-header">
            <span class="index">02</span>
            <h3>Military Academy</h3>
            <span class="card-status-dot" [class.active]="educationType === 'Academy'"></span>
          </div>
          <div class="details">
            <p><span class="label">REQUIREMENT:</span> <span class="highlight">ATTR 8+</span></p>
            <p><span class="label">EXPECTED_GAIN:</span> <span class="highlight">OFFICER COMMISSION</span></p>
            <div class="description-text">
              Intensive military training providing immediate access to officer ranks.
              Focuses on discipline, command, and specialized combat skills.
            </div>
          </div>
        </div>

        <div class="config-column" *ngIf="educationType === 'Academy'" (click)="$event.stopPropagation()">
          <div class="branch-selector">
            <span class="hud-label">[ SELECT_MIL_BRANCH ]</span>
            <select [(ngModel)]="academyType" class="cyber-select" [class.invalid]="!getAcademyValidation(academyType).available">
              <option value="Army" [disabled]="!getAcademyValidation('Army').available">
                ARMY {{ !getAcademyValidation('Army').available ? '(BLOCKED)' : '(END BRANCH)' }}
              </option>
              <option value="Marines" [disabled]="!getAcademyValidation('Marines').available">
                MARINES {{ !getAcademyValidation('Marines').available ? '(BLOCKED)' : '(END BRANCH)' }}
              </option>
              <option value="Navy" [disabled]="!getAcademyValidation('Navy').available">
                NAVY {{ !getAcademyValidation('Navy').available ? '(BLOCKED)' : '(INT BRANCH)' }}
              </option>
              <option value="Scouts" [disabled]="!getAcademyValidation('Scouts').available">
                SCOUTS {{ !getAcademyValidation('Scouts').available ? '(BLOCKED)' : '(INT BRANCH)' }}
              </option>

            </select>
            <div class="validation-reason" *ngIf="!getAcademyValidation(academyType).available">
               <span class="warning-icon">⚠</span> {{ getAcademyValidation(academyType).reason }}
            </div>
          </div>

          <div class="admission-method">
            <span class="hud-label">[ MIL_ADM_PROTOCOL ]</span>
            <div class="radio-tab-group">
              <label class="radio-tab">
                <input type="radio" name="admMethodAc" value="Local" [(ngModel)]="admissionMethod" />
                <div class="tab-content">
                  <span class="primary">LOCAL_ADM</span>
                  <span class="secondary">DM {{ admissionDMs.local >= 0 ? '+' : '' }}{{ admissionDMs.local }}</span>
                </div>
              </label>
              <label class="radio-tab">
                <input type="radio" name="admMethodAc" value="OffWorld" [(ngModel)]="admissionMethod" />
                <div class="tab-content">
                  <span class="primary">OFFWORLD_ADM</span>
                  <span class="secondary">DM {{ admissionDMs.offWorld >= 0 ? '+' : '' }}{{ admissionDMs.offWorld
                    }}</span>
                </div>
              </label>
            </div>
          </div>

          <button class="btn-action" (click)="apply()"
            [disabled]="$any(admissionStatus) !== 'NotApplied' || !getAcademyValidation(academyType).available">
            INIT_MIL_APPLICATION
          </button>
        </div>
      </div>
    </div>

    <!-- Skip Education -->
    <div class="education-card draft-card" [class.selected]="educationType === 'None'" (click)="educationType = 'None'">
      <div class="card-corner tl"></div>
      <div class="card-corner tr"></div>
      <div class="card-corner bl"></div>
      <div class="card-corner br"></div>
      <span class="card-type-tag draft">DIRECT</span>
      <div class="card-layout">
        <div class="info-column">
          <div class="card-header">
            <span class="index">03</span>
            <h3>Direct Career Entry</h3>
            <span class="card-status-dot" [class.active]="educationType === 'None'"></span>
          </div>
          <div class="details">
            <p><span class="label">STATUS:</span> <span class="highlight">IMMEDIATE_ENLISTMENT</span></p>
            <p><span class="label">ACTION:</span> <span class="highlight">SKIP HIGHER EDUCATION</span></p>
          </div>
        </div>

        <div class="config-column" *ngIf="educationType === 'None'" (click)="$event.stopPropagation()">
          <div class="draft-notice">
            <p>Skip higher education and proceed directly to a Career at age 18.
              This allows you to gain Basic Training and promotions four years earlier.</p>
          </div>
          <button class="btn-action warn" (click)="finishStep()">PROCEED_TO_CAREER</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Results -->
  <div class="results" *ngIf="$any(admissionStatus) !== 'NotApplied'" #resultsSection>
    <!-- ADMISSION ROLL SCREEN -->
    <div class="roll-phase-screen hud-module info fade-in" *ngIf="educationStep === 'AdmissionRoll'">
      <div class="corner-detail tl"></div>
      <div class="corner-detail tr"></div>
      <div class="corner-detail bl"></div>
      <div class="corner-detail br"></div>

      <div class="hud-box-header">
        <span class="index">ADM_01</span>
        <h3>ADMISSION_ROLL_PREPARATION</h3>
      </div>

      <div class="hud-content">
        <!-- Roll Formula Identity -->
        <div class="roll-spec-row">
          <span class="spec-dice">2D6</span>
          <span class="spec-sep">·</span>
          <span class="spec-stat">{{ admissionStatName }}</span>
          <span class="spec-sep">→</span>
          <span class="spec-target">{{ admissionTarget }}+</span>
        </div>

        <!-- Announcement -->
        <p class="announcement-text">{{ admissionAnnouncement }}</p>

        <!-- Modifiers Table -->
        <div class="modifiers-table">
          <div class="mod-row header">
            <span class="mod-label">MODIFIER</span>
            <span class="mod-value">VALUE</span>
          </div>
          <div class="mod-row">
            <span class="mod-label">Target Number:</span>
            <span class="mod-value">{{ admissionTarget }}</span>
          </div>
          <div class="mod-row" *ngFor="let mod of admissionModifiers">
            <span class="mod-label">{{ mod.label }}:</span>
            <span class="mod-value" [class.positive]="mod.value > 0" [class.negative]="mod.value < 0">
              {{ mod.value >= 0 ? '+' : '' }}{{ mod.value }}
            </span>
          </div>
        </div>

        <!-- Outcome Matrix -->
        <div class="outcome-matrix">
          <div class="outcome-block success">
            <div class="outcome-icon">✔</div>
            <div class="outcome-content">
              <span class="outcome-label">SUCCESS</span>
              <span class="outcome-text">Admission granted. You begin your studies immediately.</span>
            </div>
          </div>
          <div class="outcome-block failure">
            <div class="outcome-icon">✘</div>
            <div class="outcome-content">
              <span class="outcome-label">FAILURE</span>
              <span class="outcome-text">Application rejected. You may proceed directly to your career.</span>
            </div>
          </div>
        </div>
      </div>

      <div class="hud-footer tactical">
        <button class="btn-action elite" (click)="executeAdmissionRoll()">
          <span class="primary">EXECUTE_ROLL</span>
          <span class="secondary">2D6 DICE_SIMULATION</span>
        </button>
      </div>
    </div>

    <!-- ADMISSION RESULT SCREEN -->
    <div class="roll-phase-screen hud-module info fade-in" *ngIf="educationStep === 'AdmissionResult'">
      <div class="corner-detail tl"></div>
      <div class="corner-detail tr"></div>
      <div class="corner-detail bl"></div>
      <div class="corner-detail br"></div>

      <div class="hud-box-header" [class.success]="admissionStatus === 'Admitted'" [class.failure]="admissionStatus === 'Rejected'">
        <span class="index">ADM_02</span>
        <h3>ADMISSION_RESULT</h3>
      </div>

      <div class="hud-content">
        <div class="result-display" [class.admitted]="admissionStatus === 'Admitted'" [class.rejected]="admissionStatus === 'Rejected'">
          <h4>{{ admissionStatus === 'Admitted' ? 'ADMISSION APPROVED' : 'ADMISSION DENIED' }}</h4>
          <p>Roll: {{ admissionRollTotal }} vs {{ admissionTarget }}</p>
        </div>

        <div class="result-details" *ngIf="admissionStatus === 'Admitted'">
          <h5>GAINS:</h5>
          <ul>
            <li *ngIf="educationType === 'University'">EDU +1</li>
            <li *ngIf="educationType === 'University'">Select Major (Level 1) and Minor (Level 0)</li>
            <li *ngIf="educationType === 'Academy'">{{ academyType }} Academy - Basic Training granted</li>
          </ul>
        </div>
      </div>

      <div class="hud-footer tactical">
        <button *ngIf="admissionStatus === 'Admitted'" class="btn-action elite" (click)="proceedFromAdmissionResult()">
          <span class="primary">CONTINUE</span>
          <span class="secondary">PROCEED_TO_NEXT_PHASE</span>
        </button>
        <div class="button-group" *ngIf="admissionStatus === 'Rejected'" style="display: flex; gap: 1rem;">
          <button class="btn-action secondary" (click)="resetAdmission()">RETRY / CHANGE_PATH</button>
          <button class="btn-action" (click)="finishStep()">START_A_CAREER</button>
        </div>
      </div>
    </div>

    <!-- EVENT ROLL SCREEN -->
    <div class="roll-phase-screen hud-module event-phase fade-in" *ngIf="educationStep === 'EventRoll'">
      <div class="corner-detail tl"></div>
      <div class="corner-detail tr"></div>
      <div class="corner-detail bl"></div>
      <div class="corner-detail br"></div>

      <div class="hud-box-header event-header">
        <span class="index">EVT_01</span>
        <h3>EDUCATION_EVENT_TRIGGER</h3>
        <div class="status-light pulse"></div>
      </div>

      <div class="hud-content event-content">
        <div class="event-briefing">
          <p class="briefing-icon">⚡</p>
          <p class="instruction">Something significant happens during your academic studies.</p>
          <p class="sub-text">Rolling the Education Events table...</p>
        </div>
      </div>

      <div class="hud-footer tactical event-footer">
        <button class="btn-action elite modern event-roll" (click)="executeEventRoll()">
          <span class="primary">ROLL_EVENT</span>
          <span class="secondary">2D6 EVENT_SIMULATION</span>
        </button>
      </div>
    </div>

    <!-- EVENT RESULT SCREEN -->
    <div class="roll-phase-screen hud-module event-phase fade-in" *ngIf="educationStep === 'EventResult'">
      <div class="corner-detail tl"></div>
      <div class="corner-detail tr"></div>
      <div class="corner-detail bl"></div>
      <div class="corner-detail br"></div>

      <div class="hud-box-header event-header result">
        <span class="index">EVT_02</span>
        <h3>EVENT_OUTCOME</h3>
        <div class="status-light active"></div>
      </div>

      <div class="hud-content event-content result">
        <div class="event-display" *ngIf="currentEvent">
          <div class="roll-display">
            <span class="roll-label">RESULT</span>
            <span class="roll-number">{{ currentEvent.roll }}</span>
          </div>
          <div class="event-narrative">
            <p>{{ currentEvent.desc }}</p>
          </div>
        </div>
      </div>

      <div class="hud-footer tactical event-footer">
        <button class="btn-action elite modern event-proceed" (click)="proceedFromEventResult()" [disabled]="showHobbySelection || showTutorSelection || showWarOptions">
          <span class="primary">CONTINUE_TO_GRADUATION</span>
          <span class="secondary">PROCEED_NEXT_PHASE</span>
        </button>
      </div>
    </div>

    <!-- GRADUATION ROLL SCREEN -->
    <div class="roll-phase-screen hud-module info fade-in" *ngIf="educationStep === 'GraduationRoll'">
      <div class="corner-detail tl"></div>
      <div class="corner-detail tr"></div>
      <div class="corner-detail bl"></div>
      <div class="corner-detail br"></div>

      <div class="hud-box-header">
        <span class="index">GRAD_01</span>
        <h3>GRADUATION_ROLL_PREPARATION</h3>
      </div>

      <div class="hud-content">
        <!-- Roll Formula Identity -->
        <div class="roll-spec-row">
          <span class="spec-dice">2D6</span>
          <span class="spec-sep">·</span>
          <span class="spec-stat">INT</span>
          <span class="spec-sep">→</span>
          <span class="spec-target">{{ graduationTarget }}+</span>
        </div>

        <!-- Announcement with Honors Threshold -->
        <p class="announcement-text">{{ graduationAnnouncement }}</p>

        <!-- Modifiers Table -->
        <div class="modifiers-table">
          <div class="mod-row header">
            <span class="mod-label">MODIFIER</span>
            <span class="mod-value">VALUE</span>
          </div>
          <div class="mod-row">
            <span class="mod-label">Target Number:</span>
            <span class="mod-value">{{ graduationTarget }}</span>
          </div>
          <div class="mod-row" *ngFor="let mod of graduationModifiers">
            <span class="mod-label">{{ mod.label }}:</span>
            <span class="mod-value" [class.positive]="mod.value > 0" [class.negative]="mod.value < 0">
              {{ mod.value >= 0 ? '+' : '' }}{{ mod.value }}
            </span>
          </div>
        </div>

        <!-- Outcome Matrix -->
        <div class="outcome-matrix">
          <div class="outcome-block success">
            <div class="outcome-icon">✔</div>
            <div class="outcome-content">
              <span class="outcome-label">SUCCESS</span>
              <span class="outcome-text">You graduate successfully. Benefits are applied to your character sheet.</span>
            </div>
          </div>
          <div class="outcome-block failure">
            <div class="outcome-icon">✘</div>
            <div class="outcome-content">
              <span class="outcome-label">FAILURE</span>
              <span class="outcome-text">You fail to graduate. {{ educationType === 'Academy' ? 'A roll above 2 still grants automatic career entry (Rule 632).' : 'No education benefits are gained.' }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="hud-footer tactical">
        <button class="btn-action elite" (click)="executeGraduationRoll()">
          <span class="primary">EXECUTE_GRADUATION_ROLL</span>
          <span class="secondary">2D6 FINAL_ASSESSMENT</span>
        </button>
      </div>
    </div>

    <!-- University Skill Selection (Step 2) -->
    <div class="skill-selection university-polish hud-module info fade-in" *ngIf="educationStep === 'UniversitySkillSelect'" #skillsSection>
      <div class="corner-detail tl"></div>
      <div class="corner-detail tr"></div>
      <div class="corner-detail bl"></div>
      <div class="corner-detail br"></div>

      <div class="hud-box-header schematic-spec">
        <span class="index">UNI_SCHEM_V04</span>
        <h3>ADMISSION_CONFIRMED</h3>
        <div class="status-badge pulse">VECTOR_DEFINITION_REQUIRED</div>
      </div>

      <div class="hud-content compact">
        <p class="instruction">SELECT PRIMARY AND SECONDARY ACADEMIC SPECIALIZATIONS:</p>

        <div class="vector-grid compact">
          <!-- Major Vector -->
          <div class="vector-field compact">
            <label class="field-label">
              <span class="field-tag">PRIMARY</span>
              MAJOR_VECTOR (LVL 1)
            </label>
            <select [(ngModel)]="selectedMajorSkill" class="cyber-select modern" title="Primary Specialization">
              <option value="" disabled selected>SELECT_SPECIALIZATION</option>
              <option *ngFor="let s of universitySkillList" [value]="s">{{ s }}</option>
            </select>
          </div>

          <!-- Minor Vector -->
          <div class="vector-field compact">
            <label class="field-label">
              <span class="field-tag">SECONDARY</span>
              MINOR_VECTOR (LVL 0)
            </label>
            <select [(ngModel)]="selectedMinorSkill" class="cyber-select modern" title="Secondary Specialization">
              <option value="" disabled selected>SELECT_SPECIALIZATION</option>
              <option *ngFor="let s of universitySkillList" [value]="s" [disabled]="s === selectedMajorSkill">
                {{ s }}
              </option>
            </select>
          </div>
        </div>

        <!-- Selection Summary -->
        <div class="selection-summary" *ngIf="selectedMajorSkill || selectedMinorSkill">
          <div class="summary-entry" [class.filled]="selectedMajorSkill">
            <span class="summary-label">MAJ</span>
            <span class="summary-value">{{ selectedMajorSkill || '---' }}</span>
          </div>
          <div class="summary-entry" [class.filled]="selectedMinorSkill">
            <span class="summary-label">MIN</span>
            <span class="summary-value">{{ selectedMinorSkill || '---' }}</span>
          </div>
        </div>
      </div>

      <div class="hud-footer tactical compact">
        <button class="btn-action elite modern" [disabled]="!selectedMajorSkill || !selectedMinorSkill"
          (click)="confirmUniversitySkills()">
          <span class="primary">FINALIZE_ENROLLMENT</span>
          <span class="secondary">CONFIRM_VECTORS</span>
        </button>
      </div>
    </div>


    <!-- Academy Graduation Skill Selection -->
    <div class="skill-selection-module academy-polish hud-module info fade-in" *ngIf="educationStep === 'AcademySkillSelect'">
      <div class="corner-detail tl"></div>
      <div class="corner-detail tr"></div>
      <div class="corner-detail bl"></div>
      <div class="corner-detail br"></div>
      
      <div class="hud-box-header military-spec">
        <div class="scan-line"></div>
        <span class="index">MIL_SPEC_802</span>
        <h3>ACADEMY_HONORS_GRADUATION</h3>
        <div class="status-badge pulse">AWAITING_SPECIALIZATION_INPUT</div>
      </div>

      <div class="hud-content">
        <div class="schematic-overlay"></div>
        <p class="instruction">IDENTIFIED CAPABILITIES DETECTED. ALLOCATE 3 TRACE_SKILLS TO ACTIVE PROTOCOL:</p>

        <div class="skill-blueprint-grid">
          <div class="skill-chip" *ngFor="let skill of availableAcademySkills" 
            [class.selected]="isAcademySkillSelected(skill)" 
            (click)="toggleAcademySkill(skill)">
            <div class="chip-inner">
              <div class="chip-socket"></div>
              <span class="skill-name">{{ skill }}</span>
              <div class="status-led"></div>
            </div>
            <div class="chip-highlight"></div>
          </div>
        </div>
      </div>

      <div class="hud-footer tactical">
        <div class="data-readout">
          <span class="label">SYST_LOAD:</span>
          <div class="load-bar">
            <div class="fill" [style.width.%]="((selectedAcademySkills | keyvalue).length / 3) * 100"></div>
          </div>
          <span class="val">{{ (selectedAcademySkills | keyvalue).length }} / 3</span>
        </div>
        <button class="btn-action elite" [disabled]="(selectedAcademySkills | keyvalue).length !== 3"
          (click)="confirmAcademyGraduation()">
          <span class="primary">ENGAGE_PROTOCOL</span>
          <span class="secondary">FINALIZE_GRADUATION_RECORD</span>
        </button>
      </div>
    </div>

    <div *ngIf="educationStep === 'Finished' && graduationStatus !== 'Pending'" class="graduation-result">
      <div class="graduation-visual-overlay">
        <div *ngIf="educationType === 'University' && graduationStatus !== 'Failed'" class="wireframe-container active">
          <img src="assets/images/ui/wireframe_brain.png" alt="Brain Schematic" class="wireframe-asset brain">
        </div>
        <div *ngIf="educationType === 'Academy' && graduationStatus !== 'Failed'" class="wireframe-container active">
          <img src="assets/images/ui/wireframe_star.png" alt="Star Schematic" class="wireframe-asset star">
        </div>
        <div *ngIf="graduationStatus === 'Honors'" class="wireframe-container active honors">
          <img src="assets/images/ui/wireframe_medal.png" alt="Medal Schematic" class="wireframe-asset medal">
        </div>
      </div>

      <div class="result-text-block">
        <h3>{{ graduationStatus === 'Failed' ? 'GRADUATION_FAILED' : 'GRADUATION_CONFIRMED' }}</h3>
        <p *ngIf="graduationStatus === 'Honors'" class="honors-text">[ HONORS_DISTINCTION_DETECTED ]</p>
      </div>

      <!-- Special Redirections -->
      <div class="redirection-notice" *ngIf="expelledToPrison">
        <span class="warning-tag">EXPULSION_ERROR</span>
        <p>MANDATORY PROTOCOL: Proceed to [ PRISONER ] Career for next term.</p>
      </div>
      <div class="redirection-notice" *ngIf="warNextCareer">
        <span class="war-tag">WAR_PROTOCOL_ACTIVE</span>
        <p>SERVICE ASSIGNMENT: Proceed to [ {{ warNextCareer }} ] Career for next term.</p>
      </div>
    </div>
  </div>

  <!-- Interactive Overlays (Modals) -->

  <!-- War Protocol Modal -->
  <div class="overlay" *ngIf="showWarOptions">
    <div class="modal-card war-modal">
      <div class="modal-corner tl"></div>
      <div class="modal-corner tr"></div>
      <div class="modal-corner bl"></div>
      <div class="modal-corner br"></div>
      <div class="modal-scan-line"></div>
      <div class="modal-header war-header">
        <span class="index">!!</span>
        <h3>WAR_PROTOCOL</h3>
        <span class="modal-status blink">CRITICAL</span>
      </div>
      <div class="modal-body">
        <p>A national conflict has errupted. Mandatory conscription is in effect for all academic personnel.</p>
        <div class="action-grid">
          <button class="btn-action" *ngIf="canAvoidWar" (click)="avoidWar()">
            <span class="primary">AVOID_DRAFT</span>
            <span class="secondary">USE SOCIAL STANDING (SOC 9+)</span>
          </button>
          <button class="btn-action warn" (click)="joinWar('Draft')">
            <span class="primary">ACCEPT_DRAFT</span>
            <span class="secondary">ASSIGNED BY COMMAND (1D6)</span>
          </button>
          <button class="btn-action risk" (click)="joinWar('Flee')">
            <span class="primary">FLEE_PROTOCOL</span>
            <span class="secondary">ABANDON STUDIES (DRIFTER)</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Hobby Selection Modal -->
  <div class="overlay" *ngIf="showHobbySelection">
    <div class="modal-card hobby-modal">
      <div class="modal-corner tl"></div>
      <div class="modal-corner tr"></div>
      <div class="modal-corner bl"></div>
      <div class="modal-corner br"></div>
      <div class="modal-scan-line"></div>

      <div class="modal-header hobby-header">
        <span class="index">09</span>
        <h3>HOBBY_ACQUISITION</h3>
        <span class="modal-status optional">OPTIONAL</span>
      </div>

      <div class="modal-body">
        <p class="hobby-instruction">SELECT ONE SCHEMATIC TO ADOPT AS A RECREATIONAL SPECIALIZATION (LEVEL 0):</p>
        <div class="hobby-chip-grid">
          <button class="hobby-chip" *ngFor="let s of hobbySkillOptions" (click)="selectHobbySkill(s)">
            <span class="chip-led"></span>
            <span class="chip-name">{{ s }}</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Tutor Selection Modal -->
  <div class="overlay" *ngIf="showTutorSelection">
    <div class="modal-card mentor-modal tutor-modal">
      <div class="modal-corner tl"></div>
      <div class="modal-corner tr"></div>
      <div class="modal-corner bl"></div>
      <div class="modal-corner br"></div>
      <div class="modal-scan-line"></div>

      <div class="modal-header tutor-header">
        <span class="index">10</span>
        <h3>TUTOR_SPECIALIZATION</h3>
        <span class="modal-status mentor">MENTOR</span>
      </div>

      <div class="modal-body">
        <p class="tutor-instruction">AN ACADEMIC MENTOR HAS OFFERED INTENSIVE STUDY SESSIONS. SELECT A FOCUS AREA:</p>
        <div class="tutor-option-list">
          <button class="tutor-option" *ngFor="let s of tutorSkillOptions" (click)="selectTutorSkill(s)">
            <div class="tutor-option-inner">
              <span class="tutor-led"></span>
              <span class="tutor-skill-name">{{ s }}</span>
              <div class="tutor-meta">
                <span class="tutor-roll-req">ROLL 9+</span>
                <span class="tutor-effect">+1 LEVEL</span>
              </div>
            </div>
          </button>
        </div>
      </div>
    </div>
  </div>

</div>